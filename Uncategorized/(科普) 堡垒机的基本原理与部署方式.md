> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/3pizzn53f-OPFRgka9e7DQ)

本文来源：http://3t7.net/b6eda

堡垒机简介
=====

堡垒机是什么？
-------

堡垒机，即在一个特定的网络环境下，为了保障网络和数据不受来自外部和内部用户的入侵和破坏，而运用各种技术手段监控和记录运维人员对网络内的服务器、网络设备、安全设备、数据库等设备的操作行为，以便集中报警、及时处理及审计定责。[百度百科解释]

堡垒机目前也有很多叫运维审计系统。

简单总结一句话：堡垒机是用来控制哪些人可以登录哪些资产（事先防范和事中控制），以及录像记录登录资产后做了什么事情（事后溯源.）

堡垒机的核心是**可控及审计**。

可控是指权限可控、行为可控。

> 权限可控，比如某个工程师要离职或要转岗了。如果没有一个统一的权限管理入口，是一场梦魇。行为可控，比如我们需要集中禁用某个危险命令，如果没有一个统一入口，操作的难度可想而知。

堡垒机的由来：
-------

![](https://mmbiz.qpic.cn/mmbiz_png/wbiax4xEAl5zJrw1syaFz8SmX4K0qvXIDPFU48EZl6nLlYroDibXUcfRI7mXEJzS0cTplXbYbhkiaQI01qI1pxRzA/640?wx_fmt=png)堡垒机由来

图：堡垒机工作原理

堡垒机是从跳板机（也叫前置机）的概念演变过来的。早在 2000 年左右的时候，一些中大型企业为了能对运维人员的远程登录进行集中管理，会在机房部署一台跳板机。

跳板机其实就是一台 unix/windows 操作系统的服务器。所有运维人员都需要先远程登录跳板机，然后从跳板机登录其他服务器中进行运维操作。

随着技术和需求的发展，越来越多的客户需要对运维操作进行审计。因此，堡垒机应运而生。

堡垒机的发展：
-------

堡垒机的发展大致经历了三个方面：

1.  工具时代
    
    主要是作为跳板机的运维工具
    
2.  场景化时代
    
    自动运维、自动改密、工单、应用中心
    
3.  云计算时代
    
    云资产平滑接入、VPC、数据库运维、AI 运维推荐、云中心。
    

为什么需要堡垒机？
---------

这是因为在运维方面存在以下安全挑战：

1.  集中管理难
    
    主机分散（多中心，云主机）；运维入口分散，办公网络、家庭网络均需要访问。
    
2.  权限管理难
    
    账号多人共享；高权限账号滥用；越权操作、误操作等
    
3.  第三方外包
    
    运维外包；账号泄露；操作不透明；无审计；发生事故，难以定位定责
    
4.  法律法规
    
    企业运维需要监控；等级保护要求；合规性要求；
    

设计理念：
-----

堡垒机主要是有 **4A** 理念。即**认证（Authen）、授权（Authorize）、账号（Account）、审计（Audit）**为核心。

堡垒机的目标是什么？
----------

堡垒的建设目标可以概括为 5“W”，主要是为了降低运维风险。具体如下：

1.  审计：你做了什么？（What）
    
2.  授权：你能做哪些？（Which）
    
3.  账号：你要去哪？（Where）
    
4.  认证：你是谁？（Who）
    
5.  来源：访问时间？（When）
    

堡垒机的价值：
-------

1.  集中管理
    
2.  集中权限分配
    
3.  统一认证
    
4.  集中审计
    
5.  数据安全
    
6.  运维高效
    
7.  运维合规
    
8.  风险管控
    

堡垒机的分类：
-------

堡垒机分为商业堡垒机和开源堡垒，开源软件毫无疑问将是未来的主流。Jumpserver 是全球首款完全开源的堡垒机，是符合 4A 的专业运维审计系统，GitHub Star 数超过 1.1 万，Star 趋势就可以看出其受欢迎程度。

堡垒机原理
=====

目前常见堡垒机的主要功能架构：
---------------

![](https://mmbiz.qpic.cn/mmbiz_png/wbiax4xEAl5zJrw1syaFz8SmX4K0qvXID2kRETybK8eYWVvV143C4G48cagQupibPWFy4SJjgUuIrAGic5zsGpW6w/640?wx_fmt=png)

功能架构

目前常见堡垒机主要功能分为以下几个模块：

*   运维平台
    
    RDP/VNC 运维；SSH/Telnet 运维；SFTP/FTP 运维；数据库运维；Web 系统运维；远程应用运维；
    
*   管理平台
    
    三权分立；身份鉴别；主机管理；密码托管；运维监控；电子工单；
    
*   自动化平台
    
    自动改密；自动运维；自动收集；自动授权；自动备份；自动告警；
    
*   控制平台
    
    IP 防火墙；命令防火墙；访问控制；传输控制；会话阻断；运维审批；
    
*   审计平台
    
    命令记录；文字记录；SQL 记录；文件保存；全文检索；审计报表；
    

> 三权分立：
> 
> *   三权的理解：配置，授权，审计
>     
> *   三员的理解：系统管理员，安全保密管理员，安全审计员
>     
> *   三员之三权：废除超级管理员；三员是三角色并非三人；安全保密管理员与审计员必须非同一个人。
>     

堡垒机的身份认证：
---------

堡垒机主要就是为了做统一运维入口，所以登录堡垒机就支持灵活的身份认证方式：

*   本地认证：本地账号密码认证，一般支持强密码策略
    
*   远程认证：一般可支持第三方 AD/LDAP/Radius 认证
    
*   双因子认证：UsbKey、动态令牌、短信网关、手机 APP 令牌等
    
*   第三方认证系统：OAuth2.0、CAS 等。
    

堡垒机的运维方式常见有以下几种：
----------------

*   B/S 运维：通过浏览器运维。
    
*   C/S 运维：通过客户端软件运维，比如 Xshell，CRT 等。
    
*   H5 运维：直接在网页上可以打开远程桌面，进行运维。
    
    无需安装本地运维工具，只要有浏览器就可以对常用协议进行运维操作，支持 ssh、telnet、rlogin、rdp、vnc 协议
    
*   网关运维：采用 SSH 网关方式，实现代理直接登录目标主机，适用于运维自动化场景。
    

堡垒机其他常见功能：
----------

*   文件传输：一般都是登录堡垒机，通过堡垒机中转。使用 RDP/SFTP/FTP/SCP/RZ/SZ 等传输协议传输。
    
*   细粒度控制：可以对访问用户、命令、传输等进行精细化控制。
    
*   支持开放的 API
    

堡垒机常见部署方式
=========

单机部署：
-----

堡垒机主要都是旁路部署，旁挂在交换机旁边，只要能访问所有设备即可。

部署特定：

*   旁路部署，逻辑串联。
    
*   不影响现有网络结构。
    

HA 高可靠部署：
---------

旁路部署两台堡垒机，中间有心跳线连接，同步数据。对外提供一个虚拟 IP。

部署特点：

*   两台硬件堡垒机，一主一备 / 提供 VIP。
    
*   当主机出现故障时，备机自动接管服务。
    

异地同步部署模式：
---------

通过在多个数据中心部署多台堡垒机。堡垒机之间进行配置信息自动同步。

部署特点：

*   多地部署，异地配置自动同步
    
*   运维人员访问当地的堡垒机进行管理
    
*   不受网络 / 带宽影响，同时祈祷灾备目的
    

集群部署（分布式部署）：
------------

当需要管理的设备数量很多时，可以将 n 多台堡垒机进行集群部署。其中两台堡垒机一主一备，其他 n-2 台堡垒机作为集群节点，给主机上传同步数据，整个集群对外提供一个虚拟 IP 地址。

部署特点：

*   两台硬件堡垒机，一主一备、提供 VIP
    
*   当主机出现故障时，备机自动接管服务。
    

* * *

> 参考资料：
> 
> 三权分立：https://blog.csdn.net/chelp/article/details/42062489
> 
> 堡垒机是干什么的？https://www.zhihu.com/question/21036511
> 
> 推荐链接：
> 
> 【堡垒机测评】关于纽盾堡垒机、jumpserver 堡垒机、行云管家堡垒机的使用对比：https://zhuanlan.zhihu.com/p/114677806

![](https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png)  

一如既往的学习，一如既往的整理，一如即往的分享。感谢支持![](https://mmbiz.qpic.cn/mmbiz_png/p5qELRDe5icl7QVywL8iaGT0QBGpOwgD1IwN0z9JicTRvzvnsJicNRr2gRvJib6jKojzC5CJJsFPkEbZQJ999HrH5Gw/640?wx_fmt=png)  

“如侵权请私聊公众号删文”

****扫描关注 LemonSec****  

![](https://mmbiz.qpic.cn/mmbiz_png/p5qELRDe5icncXiavFRorU03O5AoZQYznLCnFJLs8RQbC9sltHYyicOu9uchegP88kUFsS8KjITnrQMfYp9g2vQfw/640?wx_fmt=png)

**觉得不错点个 **“赞”**、“在看” 哦****![](https://mmbiz.qpic.cn/mmbiz_png/3k9IT3oQhT1YhlAJOGvAaVRV0ZSSnX46ibouOHe05icukBYibdJOiaOpO06ic5eb0EMW1yhjMNRe1ibu5HuNibCcrGsqw/640?wx_fmt=png)**