\> 本文由 \[简悦 SimpRead\](http://ksria.com/simpread/) 转码， 原文地址 \[mp.weixin.qq.com\](https://mp.weixin.qq.com/s/6hKn8y0ASfwL-GL2on1r9g)

在攻防的视角里，进攻方会占据比较多的主动性，而防守方则略显被动，因为作为防守方，你永远也不知道攻击会在什么时候发生。你所能做的是，做好自己该做的一切，准备好自己该准备的一切，耐心等待对手犯错的机会。

在发现有入侵者后，快速由守转攻，进行精准地溯源反制，收集攻击路径和攻击者身份信息，勾勒出完整的攻击者画像。

![](https://mmbiz.qpic.cn/mmbiz_png/ia0LvkyJzB4k7ReyfrWfpH0R8EeM5goMSwlzianjFHibYp6NcVFZaIiabbYOup46LqQfp6OT5icQWnZ0YjKscCesIfw/640?wx_fmt=png)

**1、攻击源捕获**  

```
安全设备报警，如扫描IP、威胁阻断、病毒木马、入侵事件等
日志与流量分析，异常的通讯流量、攻击源与攻击目标等
服务器资源异常，异常的文件、账号、进程、端口，启动项、计划任务和服务等
邮件钓鱼，获取恶意文件样本、钓鱼网站URL等
蜜罐系统，获取攻击者行为、意图的相关信息

```

**2、溯源反制手段**

```
IP定位技术

    根据IP定位物理地址--代理IP
    溯源案例：通过IP端口扫描，反向渗透服务器进行分析，最终定位到攻击者相关信息

ID追踪术

    ID追踪术，搜索引擎、社交平台、技术论坛、社工库匹配
    溯源案例：利用ID从技术论坛追溯邮箱，继续通过邮箱反追踪真实姓名，通过姓名找到相关简历信息

网站url

    域名Whois查询--注册人姓名、地址、电话和邮箱。--域名隐私保护
    溯源案例：通过攻击IP历史解析记录/域名，对域名注册信息进行溯源分析

恶意样本

    提取样本特征、用户名、ID、邮箱、C2服务器等信息--同源分析
    溯源案例：样本分析过程中，发现攻击者的个人ID和QQ，成功定位到攻击者。

社交账号

    基于JSONP跨域，获取攻击者的主机信息、浏览器信息、真实 IP及社交信息等
    利用条件：可以找到相关社交网站的jsonp接口泄露敏感信息，相关网站登录未注销

```

**3、攻击者画像**

```
攻击路径

    攻击目的：拿到权限、窃取数据、获取利益、DDOS等
    网络代理：代理IP、跳板机、C2服务器等
    攻击手法：鱼叉式邮件钓鱼、Web渗透、水坑攻击、近源渗透、社会工程等

攻击者身份画像

    虚拟身份：ID、昵称、网名
    真实身份：姓名、物理位置
    联系方式：手机号、qq/微信、邮箱
    组织情况：单位名称、职位信息

```

**4、溯源案例篇**

**案例一：邮件钓鱼攻击溯源**

攻防场景：攻击者利用社会工程学技巧伪造正常邮件内容，绕过邮件网关的查杀，成功投递到目标邮箱，诱骗用户点击邮件链接或下载附件文件。

信息收集：通过查看邮件原文，获取发送方 IP 地址、域名后缀邮箱、钓鱼网站或恶意附件样本等信息。

溯源方式：第一种，可以通过相关联的域名 / IP 进行追踪；第二种，对钓鱼网站进行反向渗透获取权限，进一步收集攻击者信息；第三种，通过对邮件恶意附件进行分析，利用威胁情报数据平台寻找同源样本获取信息，也能进一步对攻击者的画像进行勾勒。

比如，收到一个邮件 QQ 空间钓鱼网站，反手插入一个 XSS 语句，盗取后台 cookie，在审查管理台源代码里找到作者的 qq 联系方式。

![](https://mmbiz.qpic.cn/mmbiz_png/ia0LvkyJzB4k7ReyfrWfpH0R8EeM5goMSelo0tgRRze5AjZSLIBuubboz3mJKnsW88sFBUW6WGXXGOpScxn85zA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/ia0LvkyJzB4k7ReyfrWfpH0R8EeM5goMSgiaiatkrgySGvq48hWyMjy9libnyb2TiaLu0fC5MqaAd1iaEDB1m8MMu76Q/640?wx_fmt=png)

**案例二：Web 入侵溯源**

攻防场景：攻击者通过 NDAY 和 0DAY 漏洞渗入服务器网段，Webshell 触发安全预警或者威胁检测阻断了 C&C 域名的通讯。

溯源方式：隔离 webshell 样本，使用 Web 日志还原攻击路径，找到安全漏洞位置进行漏洞修复，从日志可以找到攻击者的 IP 地址，但攻击者一般都会使用代理服务器或匿名网络（例如 Tor）来掩盖其真实的 IP 地址。

在入侵过程中，使用反弹 shell、远程下载恶意文件、端口远程转发等方式，也容易触发威胁阻断，而这个域名 / IP，提供一个反向信息收集和渗透测试的路径。

**案例三：蜜罐溯源**

攻防场景：在企业内网部署蜜罐去模拟各种常见的应用服务，诱导攻击者攻击。

溯源方式：在攻击者入侵蜜罐时，蜜罐可以记录攻击者的入侵行为，获取攻击者的主机信息、浏览器信息、甚至是真实 IP 及社交信息。