> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/tDhy6ANNYAhsqtT_FXUu_A)

![](https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC6pRiabDicuyO5uBZsDB68SyC0XxgOZhLhlViaOZ1YCIFFeMJjrXWeooBlQ1e4FbKVVYYVGyuZZkicfBA/640?wx_fmt=gif)

本文由 “网络安全检测与防护技术国家地方联合工程研究中心深圳分中心——东塔网络安全学院” 总结归纳

**0x0****0** **简介**

Laravel 是一套简洁、优雅的 PHP Web 开发框架 (PHP Web Framework)。它可以让你从面条一样杂乱的代码中解脱出来；它可以帮你构建一个完美的网络 APP，而且每行代码都可以简洁、富于表达力。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepOJAZpsiaWK3BK9E494CtORVlUCIxnUjWRGHd0VKFibqlGoxYT6Fm2oqjg/640?wx_fmt=png) 

**0x01 漏洞概述**

当 Laravel 开启了 Debug 模式时，由于 Laravel 自带的 Ignition 组件对 file_get_contents() 和 file_put_contents() 函数的不安全使用，攻击者可以通过发起恶意请求，构造恶意 Log 文件等方式触发 Phar 反序列化，最终造成远程代码执行。

**0x02 影响版本**

Laravel <= 8.4.2

**0x03 环境搭建**

1. 这里使用 GitHub 上已有现成的 docker 环境搭建，使用 git 下载

git clone https://github.com/SNCKER/CVE-2021-3129

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepOiaTb8iakgFHODe7qBtv1vvVHOr847E7ckjFodZGGndFQ2WZCZPJtw1pw/640?wx_fmt=png) 

2. 进入目录使用 docker-compose up -d 拉取镜像

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepOcIFDqU95XFqialdvwZbefNic96NDddxZB1NqIL8NcwcmMTk0R9G2XjKA/640?wx_fmt=png) 

3. 在浏览器访问 http://your-ip:8888, 出现以下界面环境启动成功

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepO8UoklIsZFmy4aqTNWxWTplq2dZjAGOYgvNrzrvXibP4QZfApJlDpHTw/640?wx_fmt=png) 

4. 点击首页的 “generate key” 然后刷新页面出现四个格子，表示环境搭建成功

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepO522Aj5Ha7r4tfGFkewV6Fic8b0LISV61PseTcz8OZNpAibHvhFySOg8g/640?wx_fmt=png) 

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepOhCuZGic6TIJLpxJXUUattDDcJFk6hqsGYp2nZdtpqxqEWIqHo4u2oicA/640?wx_fmt=png) 

**0x04 漏洞复现**

1、在下载 GitHub 上下载的 docker 环境中带有 exp，使用此 exp 需要下载 phpggc

git clone https://github.com/ambionics/phpggc.git

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepOgucH7G4oIzZyvHT4zpLGYzrYlsniadibX64rCWa6Ajibdz1OEosGAgmrQ/640?wx_fmt=png) 

2、给 phpggc 执行权限

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepOAMr9ibOaW4fNWUedGnqpIAeibv6B7P2jVjFLPQcicIUEic1Z8gbjbmU2LQ/640?wx_fmt=png)

3、修改 exploit.py 中的 url 为自己的漏洞地址

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepOCheV2fq8YAEHQkG7xDzrRjd6IkREBFvnR6ndP2c2v845ib0nm6SSt6w/640?wx_fmt=png) 

4、把 exp 和 phpggc 放在同一目录，使用 python3 执行 exp，可以看到执行了 exp 里命令

python3 exploit.py

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepOUPnUicEaQryHxTQJA5ZOfVuYMsF8ffStWo58RhFfF7GyKhd247od8AA/640?wx_fmt=png) 

**0x05 修复建议**

1、 建议升级至安全版本

参考链接：

https://github.com/SNCKER/CVE-2021-3129

免责申明：   

本项目仅进行信息搜集，漏洞探测工作，无漏洞利用、攻击性行为，发文初衷为仅为方便安全人员对授权项目完成测试工作和学习交流使用。

请使用者遵守当地相关法律，勿用于非授权测试，勿用于非授权测试，勿用于非授权测试（重要的事情说三遍），如作他用所承受的法律责任一概与东塔网络安全学院无关！

东塔网络安全学院在各大平台均上线了各项活动和学习内容，快快登录以下各大平台学习起来吧~  

微博、腾讯课堂、知乎、今日头条、抖音：

东塔网络安全学院

哔哩哔哩：东塔网络安全

了解更多活动和咨询欢迎微信添加：dongtakefu

  

  

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepOdQq40DibTWt4pMgbtEVuZKSBO0MvHRae7wUtUD2q8ibqLFosibTGmnrkg/640?wx_fmt=jpeg)

- 免费获取学习资料

电子书籍、试听课程 -

  

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4Gq6MngfibO5gIOIC0cSBPepOROQV77eF0eYo0gMpKvfYnaibvjrCFrRF2YMVtMUs6DNribGuTZSnRu8Q/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/FIBZec7ucChaE0GfBticZTQQq7TyhaiaeptZbqmENrZO6pazDwFpVB6aTFicgLwngsOuNLMY3sIMxddybn82O4Q8w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/FIBZec7ucChaE0GfBticZTQQq7Tyhaiaepl2oEubhGdZoAicHvXAYeSiarPXAy9OXNtJiaCkvviccX0w0Z0t0ibBnnD2Q/640?wx_fmt=png)

点击蓝字

分享我们