> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/fMCdrWOOsyDKYRkU3tYNyg)

![](https://mmbiz.qpic.cn/mmbiz_png/OhKLyqyFoP9mJwX65uY3o0wwuMo2eWPeFuDIhxJlAjMcIicKFSYLVZ6fjicY0dNle24gfmiaVpwCcP2PeZuZyaRzw/640?wx_fmt=png)点击上方蓝字关注我们

概述


------

Cisco HyperFlex HX 数据平台是一个高性能、可扩展的分布式文件系统，支持多个虚拟机管理程序，并提供多种企业级数据管理和优化服务。Cisco HyperFlex HX 安装程序虚拟机基于 Web 的管理界面中的漏洞，可能允许未经身份验证的远程攻击者对受影响的设备执行命令注入攻击。

该漏洞是由于对用户提供的输入验证不足所导致的。未经身份验证的远程攻击者可以通过向目标服务器的基于 Web 的管理界面，发送精心设计的请求来利用此漏洞。成功利用此漏洞可能允许攻击者以 root 用户身份在受影响的设备上执行任意命令。

漏洞详情


--------

Cisco HyperFlex HX 数据平台安装程序使用基于 HTTP 的 Web 控制台，可通过 https://<server_name> 访问。

其中 <server_name> 是安装 Cisco HyperFlex HX 的计算机名称。HTTP 又称超文本传输协议 HTTP，用于客户端和服务器端之间的通信。客户端向服务器发送请求，服务器将响应回复给客户端。一个 HTTP 请求由请求行、请求头、一个空行和一个可选的消息体组成：

```
Request = Request-Line headers CRLF [message-body] 
Request-Line = Method SP Request-URI SP HTTP-Version CRLF 
Headers = *[Header] 
Header = Field-Name ":" Field-Value CRLF
```

其中 CRLF 表示由回车 (CR) 字符后跟换行 (LF) 字符组成的行终止符序列，SP 表示空格字符。参数可以在请求 URI 或消息正文中作为名称 - 值对从客户端传递到服务器，具体取决于使用的方法和内容类型标头。例如，使用 GET 方法传递名为 “param”，且参数值为“1” 的一个简单的 HTTP 请求，如下所示：

```
GET /my_webapp/mypage.htm?param=1 HTTP/1.1 
Host: www.myhost.com
```

使用 POST 方法的 HTTP 请求可能如下所示：

```
POST /my_webapp/mypage.htm HTTP/1.1 
Host: www.myhost.com 
Content-Type: application/x-www-form-urlencoded 
Content-Length: 7 

param=1
```

如果需要传递多个参数 / 值对，就需要使用 “&” 符号对键值对进行分割：

var1=value1&var2=value2&var3=value3...

远程用户可以向 Cisco HyperFlex HX 服务器的 / auth / 端点提交请求，以便在安装操作之前对其进行身份验证。以下是提交到 / auth / 以执行系统恢复和重启操作的请求示例：

```
OST /auth/ HTTP/1.1 
Host: 172.16.20.56:8080 Connection: keep-alive Content-Length: 27 
[... truncated for readability ...] 

username=<someName>&password=<somePass>
```

前端 NGINX 服务器会将 HTTP 请求转发到侦听 TCP/8082 端口的后端 HTTP 服务器：

```
location ~ /auth/ 
{ 
    proxy_pass          http://127.0.0.1:8082; 
    proxy_set_header    Host $host; 
    proxy_read_timeout  3600; 
}
```

HTTP 服务器在 ELF 可执行文件 / opt/springpath/auth/auth 中实现。当它接收到发送到 / auth / 端点的 HTTP 请求时，会调用 main_loginHandler() 函数对请求进行处理。该函数首先会使用 HTTP 请求中提供的用户名值，从 / etc/shadow 文件的行中提取 salt 值。然后它将调用 main_validatePassword() 函数来验证用户提供的密码。该函数最终调用 main_checkHash() 函数。为了计算提供密码的哈希值，该函数将使用生成的 Python 代码，如下所示：

```
python -c 'import crypt; print crypt.crypt("<somePass>", "<salt>")'
```

其中 <somePass> 是 HTTP 请求中提供的密码，<salt > 是从 / etc/shadow 文件中提取的值。

这里存在一个 Python 代码注入漏洞。该漏洞是由于在使用密码生成 Python 代码字符串之前，未能正确验证密码的值导致的。攻击者可以在 password 参数的值中包含 Python 命令注入字符，以注入任意 Python 代码。例如，如下所示的值：

```
",eval(compile("""__import__('os').popen(r'COMMAND').read()""",'','single'))#
```

这意味着生成的 Python 代码将类似于：

```
import crypt; print crypt.crypt("",eval(compile("""__import__('os') 
          .popen(r'COMMAND').read()""",'','single'))#", "<salt>")
```

因此，在调用生成的 Python 代码时将执行 OS 命令。

未经身份验证的远程攻击者可以通过向目标服务器，发送精心设计的请求来利用此漏洞。成功利用此漏洞可能允许攻击者以 root 用户身份在受影响的设备上执行任意命令。

总结  



---------

思科在 2021 年 5 月对该漏洞进行了修复，在其发布的安全公告中，提到没有解决方法。因此建议受影响的用户尽快安装相应的补丁以避免受到此漏洞的影响。

![](https://mmbiz.qpic.cn/mmbiz_png/RQoDdorCu0V5znWFiaMBVWiaibdvAvmGeUvfC5LJ60x1Kq5wiaQ5UtMKEDcwQJ3ibicBdGBKxGs1V2AuZcg3ISoDto1g/640?wx_fmt=png)

  

END

  

![](https://mmbiz.qpic.cn/mmbiz_png/DQk5QiaQiciakarCFnYafgYGpNRiaX2oibtiawYX92ytrKp9MpmQeOqARcreRBybBX1fDbv2guZxExicn7f0wn2dkVwqw/640?wx_fmt=png)

好文！必须在看