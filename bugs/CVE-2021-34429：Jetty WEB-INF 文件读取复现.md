> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/mN8ek8e0bOM8Gno_2hOVuw)

**上方蓝色字体关注我们，一起学安全！**

**作者：Menge****@Timeline Sec  
**

**本文字数：907**

**阅读时长：2～3min**

**声明：仅供学习参考使用，请勿用作违法用途，否则后果自负**

**0x01 简介**  

  

Jetty 是一个开源的 servlet 容器，它为基于 Java 的 web 容器，例如 JSP 和 servlet 提供运行环境。Jetty 是使用 Java 语言编写的，它的 API 以一组 JAR 包的形式发布。开发人员可以将 Jetty 容器实例化成一个对象，可以迅速为一些独立运行（stand-alone）的 Java 应用提供网络和 web 连接。

**0x02 漏洞概述**  

  

**编号：CVE-2021-34429**  

可以使用一些编码字符来制作 URI，以访问 WEB-INF 目录的内容和 / 或绕过一些安全限制。默认合规模式允许带有包含 %u002e 段的 URI 的请求访问 WEB-INF 目录中的受保护资源。  

例如，/%u002e/WEB-INF/web.xml 可以检索 web.xml 文件的请求。这可能会泄露有关 Web 应用程序实现的敏感信息。同样，编码的空字符可能会阻止正确的规范化，因此 /.%00/WEB-INF/web.xml 也会检索 web.xml 文件。此漏洞是 CVE-2021-28164 和 CVE-2021-28169 的新的绕过方式。

**0x03 影响版本**  

  

9.4.37 ≤ Eclipse Jetty ≤ 9.4.42  

10.0.1 ≤ Eclipse Jetty ≤ 10.0.5  

11.0.1 ≤ Eclipse Jetty ≤ 11.0.5

**0x04 环境搭建**  

  

可以直接用 vulhub 项目直接搭建 jetty9.4.40 的环境，也可以自行搭建

项目地址 (版本是 jetty9.4.40)  

```
https://github.com/vulhub/vulhub/blob/master/jetty/CVE-2021-28164/
```

docker 启动  

```
cd /vulhub/jetty/CVE-2021-28164
docker-compose up -d
```

然后访问 http://your-ip:8080  

出现以下界面，搭建成功!

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsgZXLicKY82ImMPNc2h455iah9veK1bqfHclP9Fr6VSLKn5abdPXhCNF1qLPEuzY7dC1LbO1QI0HG1g/640?wx_fmt=png)

**0x05 漏洞复现**  

  

使用 curl -I http://ip:port  

可以看到 Jetty 版本

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsgZXLicKY82ImMPNc2h455iah5kiaPqVgp4JtT1KcKcsIZ2LkZjCZSDAHJ2eZQMWwjRvSmaREXuZmYtg/640?wx_fmt=png)

或是直接访问一个不存在的页面

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsgZXLicKY82ImMPNc2h455iahmABGbNTruGrbOyibONGPyJrvBjA95ViawglAqHWpZQ16Fg86PO3Vic2Zg/640?wx_fmt=png)

使用 Burpsuite 发送 GET 请求 /%u002e/WEB-INF/web.xml 即可读取到 web.xml 文件

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsgZXLicKY82ImMPNc2h455iahqia2ib3Me7sakdiau25oA8C2httvg3JKRmPMofA6ziaYFeXlzKNG57yckw/640?wx_fmt=png)

**0x06 修复方式**  

  

1. 使用补丁版本，如 9.4.43, 10.0.6, 11.0.6

2. 官网建议，可以部署一些 Jetty 重写规则，将原始请求 URI 中包含编码点段或空字符的任何请求重写为已知未找到的资源（https://github.com/eclipse/jetty.project/security/advisories/GHSA-vjv5-gp2w-65vm）  

```
<Call >
  <Arg>
    <New class="org.eclipse.jetty.rewrite.handler.RewriteRegexRule">
      <Set >.*/(?:\.+/)+.*</Set>
      <Set >/WEB-INF/Not-Found</Set>
    </New>
  </Arg>
</Call>
<Call >
  <Arg>
    <New class="org.eclipse.jetty.rewrite.handler.ValidUrlRule"/>
  </Arg>
</Call>
```

```
参考链接：
```

https://github.com/eclipse/jetty.project/security/advisories/GHSA-vjv5-gp2w-65vm  

https://mp.weixin.qq.com/s/GUsPetS256WEL90PaSNKYA

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaASAShFz46a4AgLIIYWJQKpGAnMJxQ4dugNhW5W8ia0SwhReTlse0vygkJ209LibhNVd93fGib77pNQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_jpg/VfLUYJEMVshAoU3O2dkDTzN0sqCMBceq8o0lxjLtkWHanicxqtoZPFuchn87MgA603GrkicrIhB2IKxjmQicb6KTQ/640?wx_fmt=jpeg)

**阅读原文看更多复现文章**

Timeline Sec 团队  

安全路上，与你并肩前行