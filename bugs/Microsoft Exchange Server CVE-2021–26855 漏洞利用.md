> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/iQhgQ0JkmR6pUfDxIQph1Q)

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaibJMPMBSBpUbYBe4HKJlEibgG5VKu144QqCudAgiajLn9Z9ezgBDmT3aA/640?wx_fmt=jpeg)

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaZrmQaEcAhra077pPWEYic6FTw6ylqHX9yb9JZutyrSmlOx1B1ibkR3eA/640?wx_fmt=jpeg)

微软日前发布了 Microsoft Exchange Server 的安全更新公告，其中包含多个 Exchange Server 严重安全漏洞，危害等级为 “高危”，本文将对 CVE-2021-26855 进行漏洞利用分析。

**作者：维阵漏洞研究员 --ztop**

Windows Exchange Server 是国内外应用都非常广泛的邮件服务器，2021 年 03 月 3 日，微软官方发布了 Microsoft Exchange 安全更新，并被黑客组织进行未授权 RCE 远程漏洞利用。

而 CVE-2021-26855 可以造成 Exchange 服务器端请求伪造（SSRF）漏洞，利用此漏洞的攻击者能够发送任意 HTTP 请求并通过 Exchange Server 进行身份验证。

**受影响版本有：  
**Exchange Server 2019  
Exchange Server 2016  
Exchange Server 2013  
Exchange Server 2010

**- 01 -**

**实验环境**

![](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaPmiaPWq0gzMhIYs5TT6T1Nic46yaH7mJichVWxdDmQvz0ffNzmKa1BHcw/640?wx_fmt=png)

**- 02 -**

**Exchange 环境搭建**

  

**2.1 使用 Administrator 登录，并修改密码**

如果不切换到 Administrator 用户进行安装 Exchange 的话，到了安装 Exchange 时会报一些错误。

  

**修改 Administrator 密码**

1. 按住 Windows+R 键，输入 Control，打开控制面。

2. 找到用户账户。

3. 配置高级用户配置文件属性。

4. 打开用户账户 E. 点击用户，选中 Administrators 单机右键并设置密码: root.123456。

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaamzEVSDT91vljf1ibXh8YhEsGdFkW7wAB4JuRyJliaMPa5sSodoL8hbRw/640?wx_fmt=png)

  

**使用 Administrator 登录**

注销 -- 选择 "Administrator" 进行登录。

  

**2.2 Windows Server 2016 AD 服务器搭建**

**打开服务器管理器，添加角色和功能**

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaiaHU4aQ7PZmibqPQh3X85jJuakgWCFSsQoWGWQtDKdUpiboLBIZ0szrqA/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaibEwibyhzSC02NabibO4fxN0PrtnEibsfnDI18DRVK0c6IefQGFbnHicy2g/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaDU1w6Hv5fPWb24OECchTITb7z4Gtn70LeianQVDlGZ472PbYGCrPr1w/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa7uSaWxHotrOnVLK28BeJTfJkac662BLyGga9YW3fO5H6V7awIpyreg/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaprmtD2lmaISMG67QJLmBkiaib7TwVhJnROkkM8qxFicGJMTyq1HjSflFg/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa4gqWT17HqicaJSXFXTIweWDHMMvrFkpicdBmtyfcCOkE3vVTCqDnEkLQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa05M4uhST77xcQQjqNAEStkMfibaoYKFaqI1eVAibbabt8flbbkSKD4Yw/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaXsl1Tv6vN9jqL5WqK4oQ4rc003NayG0mgVr9YuD9f3ubhgsCdJkOHA/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaGXpd4O7iasbIDZkCTpwpmYiaibre3HxJRWtfpg11SaWMQw7aicYDNd0DzA/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaTOEOnEBJGMsxgiaVibOqwrdbhjhm7qhqPicsVibTu3HRvdv8Dic4uDBvuxQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaasFR7TOFLTveNNqn6Rpnvicicqkrt4R0I7dp9ZCyxicR3Kamasc3CtauQA/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa3kx94RapicPd7WhSBaqvH6G48vnNlBZPuGY2qib4s5uhpPlkAsv00FLg/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaajTqlYBFlFibc84ibz83S96q4pPFcpFZwNId0RS4Ip9Ds2FUsFrML15iaQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa4dKtAGK0crmohSSjteXMe7WB4mb6thjkh07dk0iaC04iau5F3IybpCicw/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaagJXw2OO8mAMHkxJFsxNvzkibNYD4qBb6ibju2UlGkgJeXBwocQk2pE9A/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaafBxh9h1IFLE9n4azuW0u6G6I2uYFxGn81Y3mt1R6ok73Hfyqic2xUhw/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaaau6nCWHwpg0Fdkd6hnB23Ztakz5ibRGwNaxlibmMdkuYia1hIlAWib48GA/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaZ3djxsWibeM0DSy3bWEos7ovauqkfRPTya9ahia09PVVBYR5ljy3yr6A/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaag8FOwPKrLfgD4LEhNONH99T29xFkUfXRYqax5ibFiaegzCLtr1Az6KBQ/640?wx_fmt=png)

  

**2.3 安装 Exchange Server 2016**

**2.3.1 安装扩展 Active Directory 架构**

```
# 1. 以管理员身份运行Windows Powershell
Install-WindowsFeature RSAT-ADDS

Install-WindowsFeature NET-Framework-45-Features, 
Server-Media-Foundation, RPC-over-HTTP-proxy, RSAT-Clustering, 
RSAT-Clustering-CmdInterface, RSAT-Clustering-Mgmt, 
RSAT-Clustering-PowerShell, WAS-Process-Model, Web-Asp-Net45, 
Web-Basic-Auth, Web-Client-Auth, Web-Digest-Auth, Web-Dir-Browsing, 
Web-Dyn-Compression, Web-Http-Errors, Web-Http-Logging, 
Web-Http-Redirect, Web-Http-Tracing, Web-ISAPI-Ext, 
Web-ISAPI-Filter, Web-Lgcy-Mgmt-Console, Web-Metabase,
Web-Mgmt-Console, Web-Mgmt-Service, Web-Net-Ext45, 
Web-Request-Monitor, Web-Server, Web-Stat-Compression, 
Web-Static-Content, Web-Windows-Auth, Web-WMI, Windows-Identity-Foundation, RSAT-ADDS
```

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaacvEDpNyrKUicgB5KSLSISb3EuBCdkmevA2J9bY9BPgQwhBouCppMV4Q/640?wx_fmt=png)

  

**2.3.2 把 ExchangeServer2016-x64-cu14.iso**

**拷贝到 windows_server_2016**

```
# 1. 双击 ExchangeServer2016-x64-cu14.iso 进行挂载

# 2. 管理员打开cmd
E:
Setup.exe /IAcceptExchangeServerLicenseTerms /PrepareSchema 
Setup.exe /IAcceptExchangeServerLicenseTerms /PrepareAD /OrganizationName:"First Organization"
```

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa7FUicwibLxgBhib6SJZJibXJjL8QReTk2Q03FYun5IK22kgZqVHDXEeNjA/640?wx_fmt=png)

  

```
# 根据错误提示, 一共下载安装了下列4个程序或补丁
1. NDP472-KB4054530-x86-x64-AllOS-ENU.exe
2. UcmaRuntimeSetup.exe
3. vcredist_x64.exe
4. windows10.0-kb3206632-x64_b2e20b7e1aa65288007de21e88cd21c3ffb05110.msu
```

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaabOD3MVw7eaOO3SkJjkia0V6hDwOaXst0iaoiaQibTicoWGoZ5K72icjBExMg/640?wx_fmt=png)

  
直接运行 Setup.exe。

  

![](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaanFdh2MF6W9tpYO6DaIUibWPUOBk8fxU6eEQiandDy7CYHmpRlV0I6Vkg/640?wx_fmt=png)  

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaSTXC4ZZHYRsJzeWw5O6wQAhg0ibveoX4U8JQlX9LQp8RvvXQKCAosmQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaicWsXtsSPT94o67vZUGkBInibx3wSKDAFFp6fL1bprVlsxZWvTiaWwOgA/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaau87QKM1ib6SJib6JJwjHfAjBedO5F6zsyKrTxJmnaTicVMDDC0EQZDEcQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa0kzLox19yQcOs4sT8HfwJXU8c2jyfibEicLj61Xnc0j6uwrnQVJQEMuQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa03wibfRHOm2nSDwebsBXwkLQ45LqRxAB2H9WxyvSLG24FxyStlf9Dyg/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaKGF7NgeqW9D7Ax34mrEqg3XxUnD85ib9OY3OriaG4zxjOjOB32XRMjkA/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaO8vaDGlcrng11VoQPIHBxChj3JRpAhZOqQIHj2b5xDU3dqnaylqFCg/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaYmjTYpqIGywic66eVZYjmkiaPshQVbaYKkCYANia4UV3yotBia9icmQGqsA/640?wx_fmt=png)

  

安装完成 Exchange 后，重启系统，访问 "https://192.168.2.88/" 即可，也可以访问新建林时起的名字 "https://test.com/"。

  

下面列举的是三个登录接口：

1. https://192.168.2.88/rpc/  401 认证。

2. https://192.168.2.88/ecp/  管理中心。

3. https://192.168.2.88/owa/  邮件用户登录页面。

  

到此为止成功漏洞模拟环境基本搭建完成。

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaXibib1VF90dcK5eBzxZnUdLZljicQFZGKr9jibLvTSvB3BrTOLOzKxz2NA/640?wx_fmt=png)

  

  

**- 03 -**

**漏洞分析 CVE-2021-26855**

  

根据国外文章的分析可知，整个攻击链接可能经过以下步骤：

1. 通过 SSRF 漏洞攻击，访问 autodiscover.xml 泄露 LegacyDN 信息。

2. 在通过 LegacyDN，获取 SID。

3. 然后通过合法的 SID，获取 exchange 的有效 cookie。

4. 最后通过有效的 cookie，对 OABVirtualDirectory 对象进行恶意操作，写入一句话木马，达到控制目标的效果。

  

**3.1 漏洞点定位**

根据文章提示

"https://www.praetorian.com/blog/reproducing-proxylogon-exploit/"，并且跳过繁杂的补丁对比过程，发现由于 exchange 在处理用户发送过来的请求包中对 "X-BEResource" 字段处理不当，会造成 SSRF 漏洞攻击。   

  

我们直接定位漏洞点。

漏洞点位于 "C:\Program Files\Microsoft\ExchangeServer\V15\FrontEnd\HttpProxy\bin" 

目录下的

"Microsoft.Exchange.FrontEndHttpProxy.dll"。

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa0m7skzlOQTfJCZvuoCoxTSYFL6Tz0t6KJkKqkw4MtJmEyEK0KZy54g/640?wx_fmt=png)

把 "Microsoft.Exchange.FrontEndHttpProxy.dll" 拖入到 dnSpy 工具，可以看到在 BEResourceRequestHandler 类里，GetBEResouceCookie 函数的会获取 Cookies["X-BEResource"] 里的内容。

  

最后 "X-BEResource" 内容会经由 BackEndServer.FromString 函数进行处理。

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaGiccxmNBIDKgOknIDzvia44raVVbqANy0P8VicBanYtica3C2ly08V9n5g/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaatZlI2RlyP7k5SZA4l4QCSAuibpt6ejjO3CL2nAb5Bw4Qp6Nx6S7ibiang/640?wx_fmt=png)

  

**3.2 漏洞调试**

通过外网的文章，可以知道漏洞包：

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaAoFJdkdCarEGvcWUveKZpdrMKg6N2CWdYhmaBiaTZvJaG3m0DW9yI2g/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaHicgUebhJSpK4chuExZdsXlU5tGzicG82oROicgnsicKWqa6wBk00JRiarw/640?wx_fmt=png)

  

以下是我准备的漏洞包，为什么要访问 autodiscover.xml(自动配置文件) 呢? 是因为 Autodiscover(自动发现) 是自 Exchange Server 2007 开始推出的一项自动服务，用于自动配置用户在 Outlook 中邮箱的相关设置，简化用户登陆使用邮箱的流程。如果用户账户是域账户且当前位于域环境中，通过自动发现功能用户无需输入任何凭证信息即可登陆邮箱。

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaazr5EzVH1wAS37mVeiag1ovHtjMic1SAnnMxsqLeTGxrTdNcB1YHNfmbw/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa66cR4fQTa8F8UoCOsywUFdNmgXmibjH2rEMfsld4VzDicDEibqjerUyVw/640?wx_fmt=png)

  

在 BEResourceRequestHandler 中下三处断点。

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaW6gRAk9Ue8E6e71XQmEH73cH9ichhSzpn3ZdkKn1XnBuoV1AiaCRas3w/640?wx_fmt=png)

  

打开工具 ProcessExplorer，查找调用 BEResourceRequestHandler 的进程 "MSExchangeECPAppPool"，进程号为："10944"。

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaav5AGlcEDPzNMicduia9xzibKJONaTI45PIic6ar01FOxj5XaW6f4j1V8mQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaJ892ZiaOUYhXzclYGl2vEpkxPZ6Hz57o23bGdqhabWxEyeic88fJVnZg/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaalsDZPicQ0ebEphIEfP4bPUOqmAvqC8OOBpyO35Zr6M3vEI7BdciaqpCA/640?wx_fmt=png)

  

dnSpy 工具附加 MSExchangeECPAppPool 进程后，burpSuite 直接发包后，dnSpy 将会断下，函数的调用堆栈如下：

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaahHV1NDeNWww0brz2CLfwqNL6NuWezHTwEjoSnwQhnGziaMv9NOSEf2w/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaDFhe7wicdPWL4NHenOghZibU2NZkQbvibvOjOGMWLr8Cj7WZBowPx5mWA/640?wx_fmt=png)

  

BackEndServer.FromString() 函数在处理 beresouceCookie 时，以 "~" 符号作为分隔符，进行提取字符串，然后分别赋值给 fqdn 和 verison 变量。

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaav5Rib0eEWjNrBPjCwpWHxE2Gufsh993ZFs4icVxOFibPrHOoSBia721rlQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaSOdnbDE3aWR6feBXTMTF5iawr3iaH3VkLibp682Qz0HI2X3mjAOibzXw2w/640?wx_fmt=png)

  

fqdn 和 verison 变量将在

ProxyRequestHandler.BeginProxyRequest 类里的 GetTargetBackEndServerUrl 进行调用。

  

由于我们能控制 BackEndServer.Fqdn 参数，所以我们就控制了 clientUrlForProxy.Host. 最后重构 url 发送给后端服务器。

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaEDRBLGT5YyTCkicZOS1iaxFs1qEtOOP7ZOaWr5Z7icTEiap2zwyuuQl0KQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaav2LKib7moQQ9nXtd2PGCdHKwlHQ5XWvFsBsdOU8GI2ejqInqKficibsmg/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaiaSCSWuKcsypxlHyJiaajicT6OibnmAPkymsR5PAzVEWWrhFMUrvumTzZA/640?wx_fmt=png)

  

在进入函数 CreateServerRequest 时，会调用 PrepareServerRequest 进行 uri 代理请求的身份认证判断。

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaUa20jMZognNMyricDfh2cicDcvrK3EgdJx7zKmibibWSWwhgn1tIjicZgZA/640?wx_fmt=png)

  

ShouldBlockCurrentOAuthRequest 函数里的 ProxyToDownLevel 是用来检查用户是否已通过身份验证；而当有请求调用 BEResourceRequestHandler 时，

ShouldBackendRequestBeAnonymous() 就会被调用。

  

然后走 else 最后一个分支，绕过认证，把数据包组成后发送给后端。后端响应请求，把数据返回给客户端。最后达到一个 SSRF 漏洞攻击的过程。

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa9tb8jhSMuib014xsEICmv4Od48V6AsjwPdvibsksxZfvkLtXKWruTgjA/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaavjjgeibVW1uBiaXgdFgIJ5fBSqeX1Jwiay67EibOTRuFk8UjkHEETNx2w/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaamADia2x2qn5LWT76dg9snYqIN4RXV6G1xGmm8bq002wCAyiaic0IyicMiaw/640?wx_fmt=png)

  

**- 04 -**

**漏洞利用**

最后还有一步就是通过  

/ecp/DDI/DDIService.svc/SetObject 来操作 OABVirtualDirectory 进行文件的写入操作，这里就不在详细分析了，外网的文章已经很详细了。

![图片](https://mmbiz.qpic.cn/mmbiz_png/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaSEibHyOAWosXFsJqnotHBpBsSeLnpOOzDuUygAHc2pzIxX5KicaM4z9Q/640?wx_fmt=png)

  

**- 05 -**

**视频演示**

**往期精选**

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaaibcqvsDYLzdtCsue2hQxaeQ8icPmibzibVEiamG95pAQ4GxD2Zic9QVvTXWg/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzkyNTEwMTUzMA==&mid=2247489280&idx=1&sn=b7bcb9ab2f3e19f9e4c91cd2cda04741&chksm=c1caebb5f6bd62a3a82773805d266d15616534a28a55cbf70d256c95dac884d50d5d0676a9b5&scene=21#wechat_redirect)

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaa5DY1kqibu9SBobTxPN1ur3BHKgHwM4vVLmflA7CW1L9Yes8icchZwUjw/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzkyNTEwMTUzMA==&mid=2247489774&idx=1&sn=cda63780dd9a7482c03686cebeb3c831&chksm=c1cae45bf6bd6d4d5097e5fcfc5fbadc7f07978f109f34a8657647f527bd955a35298d3369e1&scene=21#wechat_redirect)

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/wbFNMtoYNOvsPw7QXQY26I7icJyibR7JaascichSfFeHmCaY1sqaHJJudkDwzQ6icREbt2ibgPIostLCuRtGcUTXaKw/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzkyNTEwMTUzMA==&mid=2247489667&idx=1&sn=ce20f16846a88ddc85d900db27786534&chksm=c1cae436f6bd6d200a9fbf9fdb4f5fd9c96f9ae76e90cdcfae7473626a6f19595b72b9d1e764&scene=21#wechat_redirect)

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaawy1flyRw7fKBBFHvtrhSib08PolhI62AicXsT8R6ias4op9qRoOwa9vHA/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzkyNTEwMTUzMA==&mid=2247489667&idx=1&sn=ce20f16846a88ddc85d900db27786534&chksm=c1cae436f6bd6d200a9fbf9fdb4f5fd9c96f9ae76e90cdcfae7473626a6f19595b72b9d1e764&scene=21#wechat_redirect)

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/wbFNMtoYNOvsPw7QXQY26I7icJyibR7Jaaw5aerFOrbsaY3ibUmytt6RxtYu4KQ3MAoz8zWd9xxe6GFXnJvJptDug/640?wx_fmt=jpeg)